<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Recipe & Nutrition Tracker</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="AI-powered recipe recommendations, nutrition tracking, and meal planning">
    <meta name="keywords" content="recipes, nutrition, meal planning, AI recommendations, health tracking">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="css/styles.css" rel="stylesheet">
    
    <!-- ECharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- Enhanced Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-utensils"></i> 
                <span>Smart Recipe Tracker</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon">
                    <i class="fas fa-bars"></i>
                </span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showPage('dashboard')">
                            <i class="fas fa-home me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('recipes')">
                            <i class="fas fa-search me-2"></i>Discover
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('nutrition')">
                            <i class="fas fa-chart-pie me-2"></i>Nutrition
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('meal-planner')">
                            <i class="fas fa-calendar-alt me-2"></i>Meal Plans
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('shopping')">
                            <i class="fas fa-shopping-cart me-2"></i>Shopping
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showPage('health')">
                            <i class="fas fa-heartbeat me-2"></i>Health
                        </a>
                    </li>
                </ul>
                
                <!-- Search Bar in Navbar -->
                <div class="navbar-search me-3">
                    <div class="search-container-mini">
                        <input type="text" class="form-control" placeholder="Quick search..." id="navbarSearch">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>
                
                <div class="navbar-nav">
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle user-profile" href="#" role="button" data-bs-toggle="dropdown">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=32&h=32&fit=crop&crop=face" alt="User" class="user-avatar">
                            <span id="userDisplayName">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="showPage('profile')">
                                <i class="fas fa-user me-2"></i>Profile
                            </a></li>
                            <li><a class="dropdown-item" href="#" id="updatePreferences">
                                <i class="fas fa-sliders-h me-2"></i>Preferences
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="showPage('settings')">
                                <i class="fas fa-cog me-2"></i>Settings
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid">
            
            <!-- Enhanced Dashboard Page -->
            <div id="dashboardPage" class="page-content">
                <div class="page-header">
                    <h1 class="page-title">Welcome Back!</h1>
                    <p class="page-subtitle">AI-powered nutrition tracking and personalized recipe recommendations</p>
                </div>

                <!-- Enhanced Quick Stats -->
                <div class="row mb-5">
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-fire"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="todayCalories">1,250</div>
                                <div class="stat-label">Calories Today</div>
                                <div class="stat-progress">
                                    <div class="progress">
                                        <div class="progress-bar bg-primary" style="width: 65%"></div>
                                    </div>
                                    <small class="text-muted">65% of goal</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="recipesTracked">47</div>
                                <div class="stat-label">Recipes Saved</div>
                                <div class="stat-trend">
                                    <i class="fas fa-arrow-up text-success"></i>
                                    <span class="text-success">+12 this week</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-dumbbell"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="proteinProgress">85g</div>
                                <div class="stat-label">Protein Today</div>
                                <div class="stat-progress">
                                    <div class="progress">
                                        <div class="progress-bar bg-success" style="width: 75%"></div>
                                    </div>
                                    <small class="text-muted">75% of goal</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="streakDays">7</div>
                                <div class="stat-label">Day Streak</div>
                                <div class="stat-trend">
                                    <i class="fas fa-fire text-warning"></i>
                                    <span class="text-warning">Keep it up!</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Charts Section -->
                <div class="row mb-5">
                    <div class="col-xl-8 mb-4">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h5 class="chart-title">
                                    <i class="fas fa-chart-line me-2"></i>Weekly Progress
                                </h5>
                                <div class="chart-controls">
                                    <button class="btn btn-sm btn-outline-primary">Week</button>
                                    <button class="btn btn-sm btn-outline-secondary">Month</button>
                                </div>
                            </div>
                            <div id="weeklyProgressChart" style="height: 400px;"></div>
                        </div>
                    </div>
                    <div class="col-xl-4 mb-4">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h5 class="chart-title">
                                    <i class="fas fa-pie-chart me-2"></i>Today's Nutrition
                                </h5>
                            </div>
                            <div id="dashboardNutritionChart" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions & Recent Activity -->
                <div class="row">
                    <div class="col-xl-4 mb-4">
                        <div class="card quick-actions-card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-bolt me-2"></i>Quick Actions
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="quick-action-grid">
                                    <button class="quick-action-btn" onclick="showPage('recipes')">
                                        <i class="fas fa-search"></i>
                                        <span>Find Recipes</span>
                                    </button>
                                    <button class="quick-action-btn" data-bs-toggle="modal" data-bs-target="#quickLogModal">
                                        <i class="fas fa-plus"></i>
                                        <span>Log Food</span>
                                    </button>
                                    <button class="quick-action-btn" onclick="showPage('meal-planner')">
                                        <i class="fas fa-calendar"></i>
                                        <span>Plan Meals</span>
                                    </button>
                                    <button class="quick-action-btn" onclick="runAIAnalysis()">
                                        <i class="fas fa-brain"></i>
                                        <span>AI Suggestions</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-xl-8 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-clock me-2"></i>Recent Activity
                                </h5>
                                <button class="btn btn-sm btn-outline-primary">View All</button>
                            </div>
                            <div class="card-body">
                                <div id="recentActivity">
                                    <div class="activity-item">
                                        <div class="activity-icon bg-success">
                                            <i class="fas fa-utensils"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-title">Added Grilled Salmon to meal plan</div>
                                            <div class="activity-time">2 minutes ago</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon bg-primary">
                                            <i class="fas fa-heart"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-title">Saved Mediterranean Bowl to favorites</div>
                                            <div class="activity-time">1 hour ago</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon bg-warning">
                                            <i class="fas fa-chart-pie"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-title">Logged breakfast (420 calories)</div>
                                            <div class="activity-time">3 hours ago</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Insights Widget -->
                <div class="row">
                    <div class="col-12">
                        <div class="card ai-insights-card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-brain me-2"></i>AI Insights & Recommendations
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="dashboardInsights">
                                    <div class="insight-item">
                                        <div class="insight-icon">
                                            <i class="fas fa-lightbulb"></i>
                                        </div>
                                        <div class="insight-content">
                                            <h6>Protein Goal Achievement</h6>
                                            <p>You're 15g away from your daily protein goal. Try adding Greek yogurt or nuts as a snack!</p>
                                        </div>
                                    </div>
                                    <div class="insight-item">
                                        <div class="insight-icon">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <div class="insight-content">
                                            <h6>New Recipe Match</h6>
                                            <p>Based on your preferences, we found 3 new Mediterranean recipes you might love.</p>
                                            <button class="btn btn-sm btn-primary" onclick="showPage('recipes')">View Recommendations</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Recipe Discovery Page -->
            <div id="recipesPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Discover Amazing Recipes</h1>
                    <p class="page-subtitle">Personalized recommendations powered by advanced AI algorithms</p>
                </div>

                <!-- Enhanced Search Section -->
                <div class="row mb-4">
                    <div class="col-xl-10 mx-auto">
                        <div class="search-section">
                            <div class="search-container">
                                <input type="text" class="form-control form-control-lg" id="recipeSearch" 
                                       placeholder="Search for recipes, ingredients, cuisines, or dietary needs...">
                                <button class="search-btn" onclick="searchRecipes()">
                                    <i class="fas fa-search"></i>
                                </button>
                                <div id="searchSuggestions" class="search-suggestions"></div>
                            </div>
                            
                            <div class="search-stats mt-2">
                                <small class="text-muted">
                                    <i class="fas fa-database me-1"></i>
                                    Over 330,000+ recipes from Spoonacular API
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Analysis Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="ai-analysis-card">
                            <div class="ai-analysis-content">
                                <div class="ai-icon">
                                    <i class="fas fa-brain"></i>
                                </div>
                                <div class="ai-text">
                                    <h5>Get Personalized AI Recommendations</h5>
                                    <p>Our advanced algorithm analyzes your preferences, dietary restrictions, and nutrition goals to find perfect recipes for you.</p>
                                </div>
                                <button class="btn btn-primary btn-lg" onclick="runAIAnalysis()">
                                    <i class="fas fa-magic me-2"></i>Run AI Analysis
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Filter Section -->
                <div class="filter-section">
                    <div class="filter-header">
                        <h6><i class="fas fa-filter me-2"></i>Smart Filters</h6>
                        <button class="btn btn-sm btn-outline-secondary" onclick="app.clearAllFilters()">
                            <i class="fas fa-times me-1"></i>Clear All
                        </button>
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">
                            <i class="fas fa-globe me-1"></i>All Recipes
                        </button>
                        <button class="filter-btn" data-filter="quick">
                            <i class="fas fa-bolt me-1"></i>Quick & Easy
                        </button>
                        <button class="filter-btn" data-filter="healthy">
                            <i class="fas fa-leaf me-1"></i>Healthy
                        </button>
                        <button class="filter-btn" data-filter="vegetarian">
                            <i class="fas fa-seedling me-1"></i>Vegetarian
                        </button>
                        <button class="filter-btn" data-filter="low-carb">
                            <i class="fas fa-weight-hanging me-1"></i>Low Carb
                        </button>
                        <button class="filter-btn" data-filter="high-protein">
                            <i class="fas fa-dumbbell me-1"></i>High Protein
                        </button>
                    </div>
                </div>

                <!-- Advanced Filters Accordion -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <button class="btn btn-link w-100 text-start" data-bs-toggle="collapse" data-bs-target="#advancedFilters">
                                <i class="fas fa-sliders-h me-2"></i>Advanced Filters
                                <i class="fas fa-chevron-down float-end mt-1"></i>
                            </button>
                        </h6>
                    </div>
                    <div class="collapse" id="advancedFilters">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Cuisine Type</label>
                                    <select class="form-select" id="cuisineFilter">
                                        <option value="">Any Cuisine</option>
                                        <option value="american">American</option>
                                        <option value="asian">Asian</option>
                                        <option value="mediterranean">Mediterranean</option>
                                        <option value="italian">Italian</option>
                                        <option value="mexican">Mexican</option>
                                        <option value="indian">Indian</option>
                                        <option value="chinese">Chinese</option>
                                        <option value="thai">Thai</option>
                                        <option value="japanese">Japanese</option>
                                        <option value="french">French</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Max Cook Time</label>
                                    <select class="form-select" id="timeFilter">
                                        <option value="">Any Time</option>
                                        <option value="15">Under 15 min</option>
                                        <option value="30">Under 30 min</option>
                                        <option value="45">Under 45 min</option>
                                        <option value="60">Under 1 hour</option>
                                        <option value="120">Under 2 hours</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Calorie Range</label>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="number" class="form-control" id="minCalories" placeholder="Min">
                                        </div>
                                        <div class="col-6">
                                            <input type="number" class="form-control" id="maxCalories" placeholder="Max">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Diet Type</label>
                                    <select class="form-select" id="dietFilter">
                                        <option value="">No Specific Diet</option>
                                        <option value="vegetarian">Vegetarian</option>
                                        <option value="vegan">Vegan</option>
                                        <option value="ketogenic">Ketogenic</option>
                                        <option value="paleo">Paleo</option>
                                        <option value="whole30">Whole30</option>
                                        <option value="mediterranean">Mediterranean</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button class="btn btn-primary me-2" onclick="applyAdvancedFilters()">
                                        <i class="fas fa-search me-1"></i>Apply Filters
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="clearFilters()">
                                        <i class="fas fa-eraser me-1"></i>Clear All
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recipe Results -->
                <div class="recipes-section">
                    <div class="section-header">
                        <h5><i class="fas fa-utensils me-2"></i>Recipe Results</h5>
                        <div class="view-options">
                            <button class="btn btn-sm btn-outline-secondary active" data-view="grid">
                                <i class="fas fa-th"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" data-view="list">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="row" id="recipeResults">
                        <!-- Recipes will be loaded here by JavaScript -->
                        <div class="col-12 text-center py-5">
                            <div class="loading-state">
                                <div class="loading-spinner mb-3"></div>
                                <h5 class="text-muted">Discovering amazing recipes for you...</h5>
                                <p class="text-muted">Using advanced AI to find the perfect matches</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Load More Section -->
                <div class="text-center mt-5" id="loadMoreContainer" style="display: none;">
                    <button class="btn btn-outline-primary btn-lg" onclick="loadMoreRecipes()">
                        <i class="fas fa-chevron-down me-2"></i>Discover More Recipes
                    </button>
                </div>
            </div>

            <!-- Enhanced Nutrition Tracker Page -->
            <div id="nutritionPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Nutrition Tracker</h1>
                    <p class="page-subtitle">Monitor your daily nutrition with AI-powered insights and recommendations</p>
                </div>

                <!-- Date Navigation -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="date-navigation">
                            <button class="btn btn-outline-secondary">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="current-date">
                                <input type="date" class="form-control" id="nutritionDate">
                            </div>
                            <button class="btn btn-outline-secondary">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="btn btn-primary ms-3">
                                <i class="fas fa-calendar-day me-1"></i>Today
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Daily Summary Enhanced -->
                <div class="row mb-5">
                    <div class="col-xl-8 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-chart-pie me-2"></i>Today's Nutrition Breakdown
                                </h5>
                                <div class="nutrition-summary">
                                    <span class="summary-item">
                                        <span class="summary-value">1,245</span>
                                        <span class="summary-label">calories</span>
                                    </span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="dailyNutritionChart" style="height: 450px;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-plus-circle me-2"></i>Quick Log
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Search Food</label>
                                    <div class="food-search-container">
                                        <input type="text" class="form-control" id="foodSearch" 
                                               placeholder="Search foods from Spoonacular...">
                                        <i class="fas fa-search search-icon"></i>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <label class="form-label">Quantity</label>
                                        <input type="number" class="form-control" id="foodQuantity" value="1" step="0.1">
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label class="form-label">Unit</label>
                                        <select class="form-select" id="foodUnit">
                                            <option value="serving">serving</option>
                                            <option value="cup">cup</option>
                                            <option value="tbsp">tbsp</option>
                                            <option value="gram">gram</option>
                                            <option value="oz">oz</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Meal Type</label>
                                    <select class="form-select" id="mealType">
                                        <option value="breakfast">üç≥ Breakfast</option>
                                        <option value="lunch">ü•ó Lunch</option>
                                        <option value="dinner">üçΩÔ∏è Dinner</option>
                                        <option value="snack">üçé Snack</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary w-100" onclick="logFood()">
                                    <i class="fas fa-plus me-2"></i>Log Food
                                </button>
                                
                                <!-- Quick Add Favorites -->
                                <div class="mt-3">
                                    <h6 class="mb-2">Quick Add</h6>
                                    <div class="quick-add-grid">
                                        <button class="quick-add-btn" onclick="quickLogFood('banana')">
                                            üçå Banana
                                        </button>
                                        <button class="quick-add-btn" onclick="quickLogFood('apple')">
                                            üçé Apple
                                        </button>
                                        <button class="quick-add-btn" onclick="quickLogFood('greek yogurt')">
                                            ü•õ Yogurt
                                        </button>
                                        <button class="quick-add-btn" onclick="quickLogFood('almonds')">
                                            ü•ú Nuts
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Nutrition Goals Progress -->
                <div class="row mb-5">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-target me-2"></i>Daily Goals Progress
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-xl-3 col-md-6 mb-3">
                                        <div class="goal-card enhanced" data-nutrient="calories">
                                            <div class="goal-header">
                                                <i class="fas fa-fire goal-icon"></i>
                                                <div class="goal-info">
                                                    <h6>Calories</h6>
                                                    <div class="goal-numbers">
                                                        <span class="current">1,300</span>
                                                        <span class="separator">/</span>
                                                        <span class="target">2,000</span>
                                                    </div>
                                                </div>
                                                <div class="goal-percentage">65%</div>
                                            </div>
                                            <div class="progress enhanced">
                                                <div class="progress-bar bg-primary" style="width: 65%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 mb-3">
                                        <div class="goal-card enhanced" data-nutrient="protein">
                                            <div class="goal-header">
                                                <i class="fas fa-dumbbell goal-icon"></i>
                                                <div class="goal-info">
                                                    <h6>Protein</h6>
                                                    <div class="goal-numbers">
                                                        <span class="current">120</span>
                                                        <span class="separator">/</span>
                                                        <span class="target">150g</span>
                                                    </div>
                                                </div>
                                                <div class="goal-percentage">80%</div>
                                            </div>
                                            <div class="progress enhanced">
                                                <div class="progress-bar bg-success" style="width: 80%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 mb-3">
                                        <div class="goal-card enhanced" data-nutrient="carbs">
                                            <div class="goal-header">
                                                <i class="fas fa-bread-slice goal-icon"></i>
                                                <div class="goal-info">
                                                    <h6>Carbs</h6>
                                                    <div class="goal-numbers">
                                                        <span class="current">158</span>
                                                        <span class="separator">/</span>
                                                        <span class="target">225g</span>
                                                    </div>
                                                </div>
                                                <div class="goal-percentage">70%</div>
                                            </div>
                                            <div class="progress enhanced">
                                                <div class="progress-bar bg-warning" style="width: 70%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 mb-3">
                                        <div class="goal-card enhanced" data-nutrient="fat">
                                            <div class="goal-header">
                                                <i class="fas fa-tint goal-icon"></i>
                                                <div class="goal-info">
                                                    <h6>Fat</h6>
                                                    <div class="goal-numbers">
                                                        <span class="current">40</span>
                                                        <span class="separator">/</span>
                                                        <span class="target">67g</span>
                                                    </div>
                                                </div>
                                                <div class="goal-percentage">60%</div>
                                            </div>
                                            <div class="progress enhanced">
                                                <div class="progress-bar bg-info" style="width: 60%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Logs and AI Insights -->
                <div class="row">
                    <div class="col-xl-8 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-history me-2"></i>Today's Food Log
                                </h5>
                                <button class="btn btn-sm btn-outline-primary">Export</button>
                            </div>
                            <div class="card-body">
                                <div id="recentLogs">
                                    <div class="meal-section">
                                        <h6 class="meal-title">üç≥ Breakfast</h6>
                                        <div class="food-logs">
                                            <div class="text-center py-3 text-muted">
                                                No breakfast logged yet
                                            </div>
                                        </div>
                                    </div>
                                    <div class="meal-section">
                                        <h6 class="meal-title">ü•ó Lunch</h6>
                                        <div class="food-logs">
                                            <div class="text-center py-3 text-muted">
                                                No lunch logged yet
                                            </div>
                                        </div>
                                    </div>
                                    <div class="meal-section">
                                        <h6 class="meal-title">üçΩÔ∏è Dinner</h6>
                                        <div class="food-logs">
                                            <div class="text-center py-3 text-muted">
                                                No dinner logged yet
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-brain me-2"></i>AI Nutrition Insights
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="aiInsights">
                                    <div class="insight-placeholder">
                                        <div class="insight-icon">
                                            <i class="fas fa-lightbulb"></i>
                                        </div>
                                        <div class="insight-text">
                                            <h6>Start Logging Food</h6>
                                            <p>Log your first meal to get personalized AI insights and recommendations!</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Placeholder pages for other sections -->
            <div id="meal-plannerPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">AI Meal Planner</h1>
                    <p class="page-subtitle">Generate optimized meal plans using genetic algorithms</p>
                </div>
                <!-- Meal planner content will be handled by meal-planner.js -->
            </div>

            <div id="shoppingPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Smart Shopping List</h1>
                    <p class="page-subtitle">Auto-generated from your meal plans with cost optimization</p>
                </div>
                <!-- Shopping list content -->
            </div>

            <div id="healthPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Health Tracker</h1>
                    <p class="page-subtitle">Monitor your health metrics and analyze trends</p>
                </div>
                <!-- Health tracker content -->
            </div>
        </div>
    </div>

    <!-- Enhanced Quick Log Modal -->
    <div class="modal fade" id="quickLogModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus-circle me-2"></i>Quick Food Log
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Food Description</label>
                        <input type="text" class="form-control" id="quickMealDescription" 
                               placeholder="e.g., Grilled chicken salad">
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Calories</label>
                            <input type="number" class="form-control" id="quickMealCalories" placeholder="400">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Protein (g)</label>
                            <input type="number" class="form-control" id="quickMealProtein" placeholder="25">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveQuickMeal()">
                        <i class="fas fa-save me-2"></i>Log Food
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.95); z-index: 9999; align-items: center; justify-content: center;">
        <div class="text-center text-white">
            <div class="loading-spinner mb-3"></div>
            <h5>Processing...</h5>
            <p class="text-muted">Please wait while we work our magic</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Configuration Management -->
    <script src="js/config-manager.js"></script>
    
    <!-- Firebase and API Integration -->
    <script src="js/firebase-config.js"></script>
    <script src="js/spoonacular-api.js"></script>
    
    <!-- AI Algorithms and Charts -->
    <script src="js/ai-algorithms.js"></script>
    <script src="js/charts.js"></script>
    
    <!-- Feature Modules -->
    <script src="js/nutrition-tracker.js"></script>
    <script src="js/meal-planner.js"></script>
    <script src="js/auth.js"></script>
    
    <!-- Main Application -->
    <script src="js/app.js"></script>

    <script>
        // Enhanced initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });

            // Initialize navbar search
            const navbarSearch = document.getElementById('navbarSearch');
            if (navbarSearch) {
                navbarSearch.addEventListener('input', function(e) {
                    if (e.target.value.length >= 2) {
                        // Trigger search suggestions
                        if (window.app && window.app.showSearchSuggestions) {
                            window.app.showSearchSuggestions(e.target.value);
                        }
                    }
                });
            }

            // Initialize view toggle
            document.querySelectorAll('[data-view]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-view]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    // Handle view change logic here
                });
            });
        });

        // Enhanced save quick meal function
        function saveQuickMeal() {
            const description = document.getElementById('quickMealDescription').value;
            const calories = document.getElementById('quickMealCalories').value;
            const protein = document.getElementById('quickMealProtein').value;
            
            if (description && calories) {
                if (window.nutritionTracker) {
                    window.nutritionTracker.logFood({
                        food: description,
                        calories: parseInt(calories),
                        protein: parseInt(protein) || 0,
                        carbs: 0,
                        fat: 0,
                        meal: 'snack'
                    });
                }
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('quickLogModal'));
                modal.hide();
                
                // Clear form
                document.getElementById('quickMealDescription').value = '';
                document.getElementById('quickMealCalories').value = '';
                document.getElementById('quickMealProtein').value = '';
            }
        }

        // Quick log function for preset foods
        function quickLogFood(foodName) {
            if (window.app) {
                window.app.showSuccess(`Logging ${foodName}...`);
                // Here you would call the Spoonacular API to get nutrition data
                // For now, we'll just show a success message
            }
        }

        // Apply advanced filters function
        function applyAdvancedFilters() {
            if (window.app) {
                const filters = {
                    cuisine: document.getElementById('cuisineFilter')?.value,
                    maxReadyTime: document.getElementById('timeFilter')?.value,
                    minCalories: document.getElementById('minCalories')?.value,
                    maxCalories: document.getElementById('maxCalories')?.value,
                    diet: document.getElementById('dietFilter')?.value
                };
                
                const query = document.getElementById('recipeSearch')?.value || '';
                window.app.searchRecipes(query, filters);
            }
        }

        // Clear filters function
        function clearFilters() {
            // Reset all filter inputs
            ['cuisineFilter', 'timeFilter', 'minCalories', 'maxCalories', 'dietFilter', 'recipeSearch'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.value = '';
            });
            
            // Reset filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-btn[data-filter="all"]')?.classList.add('active');
            
            // Get fresh suggestions
            if (window.app) {
                window.app.getPersonalizedSuggestions();
            }
        }

        // Load more recipes function
        function loadMoreRecipes() {
            if (window.app) {
                window.app.showSuccess('Loading more recipes...');
                // Implementation would load next batch of results
            }
        }

        // Log food function
        function logFood() {
            if (window.app) {
                window.app.logFood();
            }
        }
    </script>

    <!-- Additional CSS for enhanced components -->
    <style>
        /* Enhanced component styles */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            border-top: none;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: var(--spacing-md);
            cursor: pointer;
            transition: var(--transition-fast);
            border-bottom: 1px solid var(--glass-border);
        }

        .suggestion-item:hover {
            background: var(--bg-hover);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .navbar-search {
            min-width: 250px;
        }

        .search-container-mini {
            position: relative;
        }

        .search-container-mini .form-control {
            padding-right: 40px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
        }

        .search-container-mini .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .stat-card {
            position: relative;
            overflow: visible;
        }

        .stat-icon {
            position: absolute;
            top: -10px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow-md);
        }

        .stat-content {
            padding-right: 80px;
        }

        .stat-trend {
            margin-top: var(--spacing-xs);
            font-size: 0.875rem;
        }

        .stat-progress {
            margin-top: var(--spacing-sm);
        }

        .stat-progress .progress {
            height: 6px;
            margin-bottom: var(--spacing-xs);
        }

        .quick-actions-card .card-body {
            padding: var(--spacing-xl);
        }

        .quick-action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .quick-action-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            transition: var(--transition-normal);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--text-primary);
            text-decoration: none;
        }

        .quick-action-btn:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            color: var(--text-primary);
        }

        .quick-action-btn i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        .activity-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .activity-time {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .ai-insights-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            padding: var(--spacing-lg);
            background: var(--glass-bg);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-md);
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .insight-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .insight-content h6 {
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }

        .insight-content p {
            margin-bottom: var(--spacing-sm);
            color: var(--text-secondary);
        }

        .ai-analysis-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-xl);
            text-align: center;
        }

        .ai-analysis-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            max-width: 800px;
            margin: 0 auto;
        }

        .ai-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            flex-shrink: 0;
            animation: pulse 2s ease-in-out infinite;
        }

        .ai-text {
            text-align: left;
            flex: 1;
        }

        .ai-text h5 {
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
        }

        .ai-text p {
            margin-bottom: 0;
            color: var(--text-secondary);
        }

        .date-navigation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-md);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
        }

        .current-date input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-weight: 600;
            text-align: center;
        }

        .nutrition-summary {
            display: flex;
            gap: var(--spacing-lg);
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            display: block;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .summary-label {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .food-search-container {
            position: relative;
        }

        .food-search-container .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .quick-add-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-sm);
        }

        .quick-add-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm);
            font-size: 0.875rem;
            transition: var(--transition-fast);
            cursor: pointer;
            color: var(--text-primary);
        }

        .quick-add-btn:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
        }

        .goal-card.enhanced {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            transition: var(--transition-normal);
        }

        .goal-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .goal-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .goal-info {
            flex: 1;
        }

        .goal-info h6 {
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .goal-numbers {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .goal-numbers .current {
            color: var(--primary-color);
        }

        .goal-numbers .separator {
            color: var(--text-muted);
            margin: 0 2px;
        }

        .goal-numbers .target {
            color: var(--text-secondary);
        }

        .goal-percentage {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .progress.enhanced {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
        }

        .meal-section {
            margin-bottom: var(--spacing-xl);
        }

        .meal-title {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--glass-border);
        }

        .food-logs {
            background: var(--glass-bg);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
        }

        .insight-placeholder {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-lg);
            background: var(--glass-bg);
            border-radius: var(--radius-lg);
        }

        .insight-placeholder .insight-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .insight-text h6 {
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }

        .insight-text p {
            margin-bottom: 0;
            color: var(--text-secondary);
        }

        .loading-state {
            padding: var(--spacing-2xl);
        }

        .loading-state h5 {
            margin-bottom: var(--spacing-sm);
        }

        .recipes-section {
            margin-top: var(--spacing-xl);
        }

        .section-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .section-header h5 {
            margin-bottom: 0;
            color: var(--text-primary);
        }

        .view-options {
            display: flex;
            gap: var(--spacing-xs);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .chart-controls {
            display: flex;
            gap: var(--spacing-xs);
        }

        @media (max-width: 768px) {
            .ai-analysis-content {
                flex-direction: column;
                text-align: center;
            }

            .ai-text {
                text-align: center;
            }

            .stat-icon {
                display: none;
            }

            .stat-content {
                padding-right: 0;
            }

            .quick-action-grid {
                grid-template-columns: 1fr;
            }

            .navbar-search {
                display: none;
            }

            .goal-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-sm);
            }
        }
    </style>
</body>
</html>